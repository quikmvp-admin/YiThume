<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YiThume â€” Health delivered. Fast.</title>
  <meta name="description" content="YiThume delivers OTC meds to remote areas. Order on WhatsApp. Port Alfred, Bathurst, Makhanda/Grahamstown, Alice, Kenton-on-Sea, Alexandria, Alicedale." />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    :root{
      --emerald-600:#059669; --emerald-500:#10b981; --emerald-400:#34d399; --emerald-800:#047857; --emerald-900:#065f46;
      --map-bg:#f6f8f9;
      --hero-h: 360px;
    }
    @media (max-width:640px){ :root{ --hero-h: 280px; } }

    .leaflet-pane, .leaflet-top, .leaflet-bottom { z-index: 10 !important; }

    #heroMap{height:var(--hero-h);border-radius:16px;position:relative;overflow:hidden;background:var(--map-bg);}
    .leaflet-control-container{display:none;}

    .car-dot{transform:translate(-50%,-50%); will-change: transform;}
    .car-dot svg{width:18px;height:18px;display:block;filter:drop-shadow(0 1px 1px rgba(0,0,0,.18));}
    .car-A path{fill:var(--emerald-600);} .car-B path{fill:var(--emerald-500);}
    .car-C path{fill:var(--emerald-400);} .car-D path{fill:var(--emerald-800);} .car-E path{fill:var(--emerald-900);}
    .pkg-dot{transform:translate(-50%,-50%); will-change: transform;}
    .pkg-dot svg{width:20px;height:20px;filter:drop-shadow(0 1px 1px rgba(0,0,0,.15))}

    .tint{position:absolute; inset:0; background:linear-gradient(180deg,rgba(5,150,105,.04),rgba(5,150,105,.03)); pointer-events:none;}
    .ec-badge{
      position:absolute; left:14px; bottom:12px;
      padding:6px 10px; border-radius:10px;
      background:rgba(15,23,42,.75); color:#fff; font-size:12px;
      backdrop-filter: blur(2px);
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-white to-slate-50 text-slate-900">
  <script>
    const WHATSAPP_NUMBER = "270691456201";
    const ADMIN_WHATSAPP  = "270691456201";
    const customerStartText = encodeURIComponent("Hi YiThume ðŸ‘‹ I'd like to order medication.");
    const driverStartText   = encodeURIComponent("Hi YiThume â€” Driver sign-in.");
    window.YI_LINKS = {
      customer:`https://wa.me/${WHATSAPP_NUMBER}?text=${customerStartText}`,
      driver:`https://wa.me/${WHATSAPP_NUMBER}?text=${driverStartText}`
    };
  </script>

  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <svg width="36" height="36" viewBox="0 0 36 36" class="rounded-2xl" aria-label="YiThume logo">
          <defs><linearGradient id="g" x1="0" x2="1" y1="0" y2="1"><stop offset="0%" stop-color="#10b981"/><stop offset="100%" stop-color="#059669"/></linearGradient></defs>
          <rect rx="12" width="36" height="36" fill="url(#g)"/>
          <path d="M10 12l5 8v4h-3v-3l-5-9h3zM26 12l-5 8v4h3v-3l5-9h-3z" fill="#fff"/>
        </svg>
        <div class="text-xl font-semibold tracking-tight">YiThume</div>
      </div>
      <nav class="hidden md:flex items-center gap-6">
        <a href="#how" class="text-sm hover:text-emerald-700">How It Works</a>
        <a href="#services" class="text-sm hover:text-emerald-700">Services</a>
        <a href="#pricing" class="text-sm hover:text-emerald-700">Pricing & Zones</a>
        <a href="#drivers" class="text-sm hover:text-emerald-700">For Drivers</a>
        <a href="#faq" class="text-sm hover:text-emerald-700">FAQ</a>
      </nav>
      <div class="hidden sm:flex items-center gap-3">
        <button id="openOrderBuilderTop" class="px-3 py-2 text-sm rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Start order</button>
        <button id="openDriverModalTop" class="px-3 py-2 text-sm rounded-xl border border-slate-300 hover:bg-slate-100">Driver sign-in / up</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="relative">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-14 sm:py-20 grid md:[grid-template-columns:1.2fr_1fr] gap-10 items-stretch">
      <!-- Left: now a card that matches map height -->
      <div class="flex">
        <div class="rounded-3xl border bg-white p-6 shadow-sm h-full w-full min-h-[var(--hero-h)] flex flex-col">
          <div>
            <h1 class="text-4xl sm:text-5xl font-bold leading-tight">Health delivered. <span class="text-emerald-600">Fast</span>.</h1>
            <p class="mt-4 text-slate-700 max-w-xl">YiThume brings <strong>OTC meds</strong> to remote areas via WhatsApp. Simple ordering, clear pricing, and trusted local drivers.</p>
          </div>

          <!-- Benefits (not buttons) -->
          <ul class="mt-6 grid grid-cols-2 gap-3 text-sm">
            <li class="flex items-start gap-2">
              <span class="mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-md bg-emerald-100 text-emerald-700">âœ“</span>
              <div><b>Order on WhatsApp</b><div class="text-slate-500 text-xs">No app needed</div></div>
            </li>
            <li class="flex items-start gap-2">
              <span class="mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-md bg-emerald-100 text-emerald-700">âœ“</span>
              <div><b>Same-day windows</b><div class="text-slate-500 text-xs">08â€“10 â€¢ 12â€“14 â€¢ 16â€“18</div></div>
            </li>
            <li class="flex items-start gap-2">
              <span class="mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-md bg-emerald-100 text-emerald-700">âœ“</span>
              <div><b>Local drivers</b><div class="text-slate-500 text-xs">Verified per zone</div></div>
            </li>
            <li class="flex items-start gap-2">
              <span class="mt-0.5 inline-flex h-5 w-5 items-center justify-center rounded-md bg-emerald-100 text-emerald-700">âœ“</span>
              <div><b>Cash or EFT</b><div class="text-slate-500 text-xs">Card link via chat</div></div>
            </li>
          </ul>

          <!-- CTAs -->
          <div class="mt-6 flex flex-col sm:flex-row gap-3">
            <button id="openOrderBuilder" class="px-5 py-3 rounded-2xl bg-emerald-600 text-white text-sm font-medium hover:bg-emerald-700">Start order</button>
            <button id="openDriverModal" class="px-5 py-3 rounded-2xl border border-slate-300 text-slate-800 text-sm font-medium hover:bg-slate-100">Sign up / Log in (Driver)</button>
          </div>
          <div class="mt-3 text-xs text-slate-500">Build your basket here â€” weâ€™ll send it to WhatsApp for confirmation & payment.</div>

          <!-- Spacer to push content and keep equal height nicely -->
          <div class="mt-auto"></div>
        </div>
      </div>

      <!-- Right: coverage map card -->
      <div class="flex">
        <div class="rounded-3xl border bg-white p-3 shadow-sm h-full w-full relative min-h-[var(--hero-h)]">
          <div class="flex items-center justify-between px-1 pb-2">
            <div class="text-sm text-slate-600">Coverage map</div>
            <span class="px-2 py-1 text-xs rounded-lg bg-emerald-100 text-emerald-700">LIVE</span>
          </div>
          <div id="heroMap" class="rounded-2xl"></div>
          <div class="tint"></div>
          <div class="ec-badge">Eastern Cape</div>
        </div>
      </div>
    </div>
  </section>

  <!-- How it works -->
  <section id="how" class="py-12 sm:py-16 border-t border-slate-200">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <h2 class="text-2xl sm:3xl font-bold">How YiThume Works</h2>
      <div class="mt-6 grid md:grid-cols-4 gap-4">
        <div class="p-5 rounded-2xl bg-white border shadow-sm"><div class="text-sm text-slate-500">Step 1</div><div class="mt-1 font-semibold">WhatsApp us</div><p class="mt-2 text-sm text-slate-700">Tap the WhatsApp button. Weâ€™ll ask the right questions and place your order.</p></div>
        <div class="p-5 rounded-2xl bg-white border shadow-sm"><div class="text-sm text-slate-500">Step 2</div><div class="mt-1 font-semibold">Confirm items</div><p class="mt-2 text-sm text-slate-700">Share your list (e.g., Panado x2). Script meds require a valid prescription.</p></div>
        <div class="p-5 rounded-2xl bg-white border shadow-sm"><div class="text-sm text-slate-500">Step 3</div><div class="mt-1 font-semibold">We dispatch</div><p class="mt-2 text-sm text-slate-700">A verified driver picks up from a partner pharmacy and heads to you.</p></div>
        <div class="p-5 rounded-2xl bg-white border shadow-sm"><div class="text-sm text-slate-500">Step 4</div><div class="mt-1 font-semibold">Pay & receive</div><p class="mt-2 text-sm text-slate-700">Cash or EFT on delivery. Weâ€™ll keep you updated in the chat.</p></div>
      </div>
    </div>
  </section>

  <!-- Pricing & Zones -->
  <section id="pricing" class="py-12 sm:py-16 border-t border-slate-200">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <h2 class="text-2xl sm:text-3xl font-bold">Pricing & Zones</h2>
      <div class="mt-6 overflow-hidden rounded-2xl border bg-white">
        <table class="w-full text-sm">
          <thead class="bg-slate-50 text-slate-600"><tr><th class="py-3 px-4 text-left">Zone</th><th class="py-3 px-4 text-left">Areas</th><th class="py-3 px-4 text-left">Delivery Fee</th></tr></thead>
          <tbody>
            <tr class="border-t"><td class="py-3 px-4 font-medium">Zone A</td><td class="py-3 px-4">Port Alfred, Nemato, East Beach, Seafield</td><td class="py-3 px-4">R25</td></tr>
            <tr class="border-t"><td class="py-3 px-4 font-medium">Zone B</td><td class="py-3 px-4">Bathurst, Eluce/Elitsi</td><td class="py-3 px-4">R35</td></tr>
            <tr class="border-t"><td class="py-3 px-4 font-medium">Zone C</td><td class="py-3 px-4">Kenton-on-Sea, Bushmans River, Boesmansriviermond</td><td class="py-3 px-4">R45</td></tr>
            <tr class="border-t"><td class="py-3 px-4 font-medium">Zone D</td><td class="py-3 px-4">Makhanda/Grahamstown, Eirini</td><td class="py-3 px-4">R60</td></tr>
            <tr class="border-t"><td class="py-3 px-4 font-medium">Zone E</td><td class="py-3 px-4">Alexandria, Alicedale, Surrounding Rural Areas</td><td class="py-3 px-4">R70</td></tr>
          </tbody>
        </table>
      </div>
      <div class="mt-4 text-xs text-slate-500">Delivery days: Wedâ€“Sun. Rush +R30 when available.</div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="py-12 sm:py-16 border-t border-slate-200">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <h2 class="text-2xl sm:text-3xl font-bold">FAQ</h2>
      <div class="mt-6 grid md:grid-cols-2 gap-4">
        <details class="p-4 rounded-xl bg-white border shadow-sm"><summary class="font-medium cursor-pointer">Do you give medical advice?</summary><p class="mt-2 text-sm text-slate-700">No. YiThume provides delivery only. Always follow your healthcare providerâ€™s guidance.</p></details>
        <details class="p-4 rounded-xl bg-white border shadow-sm"><summary class="font-medium cursor-pointer">Do you deliver prescription meds?</summary><p class="mt-2 text-sm text-slate-700">Yes, with a valid script and ID where required.</p></details>
        <details class="p-4 rounded-xl bg-white border shadow-sm"><summary class="font-medium cursor-pointer">How do I pay?</summary><p class="mt-2 text-sm text-slate-700">EFT or secure card link shared in WhatsApp.</p></details>
        <details class="p-4 rounded-xl bg-white border shadow-sm"><summary class="font-medium cursor-pointer">Where do you operate?</summary><p class="mt-2 text-sm text-slate-700">Port Alfred, Bathurst, Kenton-on-Sea, Makhanda/Grahamstown, Alice, Alexandria, Alicedale (more soon).</p></details>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-10 border-t border-slate-200">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <div>
          <div class="font-semibold">YiThume</div>
          <div class="text-xs text-slate-500">Delivery service only â€¢ POPIA compliant â€¢ Â© <span id="year"></span></div>
        </div>
        <div class="flex gap-3">
          <button id="openOrderBuilderFooter" class="px-3 py-2 text-sm rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Start order</button>
          <button id="openDriverModalFooter" class="px-3 py-2 text-sm rounded-xl border border-slate-300 hover:bg-slate-100">Driver sign-in / up</button>
        </div>
      </div>
    </div>
  </footer>

  <!-- Driver Modal -->
  <div id="driverModal" class="fixed inset-0 hidden items-start justify-center pt-16 sm:pt-20 bg-black/40 p-4 z-[9999]">
    <div class="w-full max-w-xl rounded-2xl bg-white shadow-xl border">
      <div class="flex items-center justify-between p-4 border-b">
        <div class="font-semibold">Driver â€” Sign up / Log in</div>
        <button id="closeDriverModal" class="text-slate-500 hover:text-slate-700">âœ•</button>
      </div>
      <div class="p-4">
        <div class="flex gap-2 text-sm mb-4">
          <button id="tabSignup" class="px-3 py-1 rounded-lg bg-emerald-600 text-white">Sign up</button>
          <button id="tabLogin" class="px-3 py-1 rounded-lg border border-slate-300">Log in</button>
        </div>
        <form id="driverFormSignup" class="grid sm:grid-cols-2 gap-3 text-sm">
          <label class="sm:col-span-1">Full name<input id="drvName" type="text" class="mt-1 w-full border rounded-lg p-2" placeholder="e.g. Sipho M" required></label>
          <label class="sm:col-span-1">Phone (WhatsApp)<input id="drvPhone" type="tel" class="mt-1 w-full border rounded-lg p-2" placeholder="2782..." required></label>
          <label class="sm:col-span-1">Zone
            <select id="drvZone" class="mt-1 w-full border rounded-lg p-2">
              <option value="A">Zone A â€“ Port Alfred</option>
              <option value="B">Zone B â€“ Bathurst</option>
              <option value="C">Zone C â€“ Kenton / Bushmans</option>
              <option value="D">Zone D â€“ Makhanda / Eirini</option>
              <option value="E">Zone E â€“ Alexandria / Alicedale</option>
            </select>
          </label>
          <label class="sm:col-span-1">Radius (km)
            <select id="drvRadius" class="mt-1 w-full border rounded-lg p-2">
              <option>3</option><option>5</option><option selected>10</option><option>15</option>
            </select>
          </label>
          <label class="sm:col-span-2">Vehicle<input id="drvVehicle" type="text" class="mt-1 w-full border rounded-lg p-2" placeholder="Bike / Car"></label>
          <div class="sm:col-span-2 flex justify-end gap-2 mt-2">
            <button id="drvSubmitSignup" type="submit" class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Send sign-up</button>
          </div>
        </form>
        <form id="driverFormLogin" class="grid sm:grid-cols-2 gap-3 text-sm hidden">
          <label class="sm:col-span-1">Phone (WhatsApp)<input id="drvPhoneLogin" type="tel" class="mt-1 w-full border rounded-lg p-2" placeholder="2782..." required></label>
          <label class="sm:col-span-1">PIN<input id="drvPin" type="password" class="mt-1 w-full border rounded-lg p-2" placeholder="â€¢â€¢â€¢â€¢" required></label>
          <div class="sm:col-span-2 flex justify-end gap-2 mt-2">
            <button id="drvSubmitLogin" type="submit" class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Log in</button>
          </div>
        </form>
        <p class="mt-3 text-xs text-slate-500">Weâ€™ll confirm by WhatsApp. Your pin/driver record is demo-only here.</p>
      </div>
    </div>
  </div>

  <!-- Bot-style Checkout Modal -->
  <div id="botChat" class="fixed inset-0 hidden items-start justify-center pt-16 sm:pt-20 bg-black/40 p-4 z-[9999]">
    <div class="w-full max-w-xl rounded-2xl bg-white shadow-xl border flex flex-col">
      <div class="flex items-center justify-between p-4 border-b"><div class="font-semibold">Checkout â€” YiThume Bot</div><button id="closeBot" class="text-slate-500 hover:text-slate-700">âœ•</button></div>
      <div id="botFeed" class="p-4 space-y-2 h-80 overflow-auto bg-slate-50"></div>
      <div class="p-4 border-t grid sm:grid-cols-4 gap-3 items-center">
        <label class="sm:col-span-3 text-sm">Payment Method
          <select id="botPayChoice" class="mt-1 w-full border rounded-lg p-2"><option value="eft">EFT (send POP)</option><option value="card">Card link</option></select>
        </label>
        <div class="flex gap-2 sm:justify-end">
          <button id="botNext" class="px-4 py-2 rounded-xl border border-slate-300 hover:bg-slate-100 text-sm">Next</button>
          <button id="botSendWA" class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 text-sm">Send to WhatsApp</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Builder Modal -->
  <div id="orderBuilder" class="fixed inset-0 hidden items-start justify-center pt-16 sm:pt-20 bg-black/40 p-4 z-[9999]">
    <div class="w-full max-w-2xl rounded-2xl bg-white shadow-xl border">
      <div class="flex items-center justify-between p-4 border-b"><div class="font-semibold">Build your order</div><button id="closeOrderBuilder" class="text-slate-500 hover:text-slate-700">âœ•</button></div>
      <div class="p-4 grid md:grid-cols-2 gap-4 text-sm">
        <div>
          <div class="font-medium mb-2">Items</div>
          <div class="space-y-2" id="itemsList"></div>
          <div class="mt-3"><button id="addCustomItem" class="text-emerald-700 text-xs underline">+ Add custom item</button></div>
        </div>
        <div>
          <div class="font-medium mb-2">Delivery</div>
          <label class="block mb-2">Zone
            <select id="zoneSelect" class="mt-1 w-full border rounded-lg p-2">
              <option value="A" data-fee="25">Zone A â€” R25</option>
              <option value="B" data-fee="35">Zone B â€” R35</option>
              <option value="C" data-fee="45">Zone C â€” R45</option>
              <option value="D" data-fee="60">Zone D â€” R60</option>
              <option value="E" data-fee="70">Zone E â€” R70</option>
            </select>
          </label>
          <label class="inline-flex items-center gap-2 mt-2"><input id="rushToggle" type="checkbox" class="h-4 w-4"><span>Request same-day (rush) +R30</span></label>
          <div class="mt-4 font-medium">Payment</div>
          <label class="flex items-center gap-2 mt-2"><input type="radio" name="pay" value="eft" checked> EFT (send POP)</label>
          <label class="flex items-center gap-2 mt-1"><input type="radio" name="pay" value="card"> Card link via WhatsApp</label>
          <div class="mt-4 p-3 rounded-xl bg-slate-50 border">
            <div class="text-slate-500">Order Total</div>
            <div class="text-2xl font-bold">R<span id="orderTotal">0</span></div>
            <div class="text-xs text-slate-500 mt-1">Includes items + delivery fee{rush}</div>
          </div>
        </div>
      </div>
      <div class="p-4 border-t flex items-center justify-between text-sm">
        <div class="text-slate-600">By confirming, you accept the cost. Weâ€™ll send payment instructions in WhatsApp.</div>
        <div class="flex gap-2"><button id="confirmOrderBtn" class="px-4 py-2 rounded-2xl bg-emerald-600 text-white hover:bg-emerald-700">Checkout</button></div>
      </div>
    </div>
  </div>

  <script>
  window.addEventListener('DOMContentLoaded', () => {
    const yearEl=document.getElementById('year'); if(yearEl) yearEl.textContent=new Date().getFullYear();

    const modal=document.getElementById('orderBuilder');
    const openOrderButtons=['openOrderBuilder','openOrderBuilderTop','openOrderBuilderFooter'];
    const closeBtn=document.getElementById('closeOrderBuilder');
    const itemsList=document.getElementById('itemsList');
    const zoneSelect=document.getElementById('zoneSelect');
    const rushToggle=document.getElementById('rushToggle');
    const totalEl=document.getElementById('orderTotal');

    const CATALOG=[
      {name:'Panado 500mg (24s)',price:35},
      {name:'Allergex 10mg (10s)',price:30},
      {name:'Cough Syrup 100ml',price:55},
      {name:'Electrolyte Sachet',price:15},
      {name:'Bandages (set)',price:25}
    ];

    function renderItems(){
      itemsList.innerHTML='';
      CATALOG.forEach((item,idx)=>{
        const row=document.createElement('div');
        row.className='flex items-center justify-between gap-3 border rounded-lg p-2';
        row.innerHTML=`<label class="flex items-center gap-2"><input type="checkbox" data-idx="${idx}" class="itemCheck h-4 w-4"/><span>${item.name}</span></label><div class="flex items-center gap-2"><span class="text-slate-500">R${item.price}</span><input type="number" min="1" value="1" data-idx="${idx}" class="itemQty w-14 border rounded-lg p-1"/></div>`;
        itemsList.appendChild(row);
      });
    }
    function computeTotal(){
      const fee=Number(zoneSelect.options[zoneSelect.selectedIndex].dataset.fee||0);
      const rush=rushToggle.checked?30:0;
      const items=Array.from(document.querySelectorAll('.itemCheck')).filter(c=>c.checked).map(c=>{
        const i=Number(c.dataset.idx);
        const qty=Number(document.querySelector(`.itemQty[data-idx="${i}"]`).value||1);
        return {name:CATALOG[i].name,price:CATALOG[i].price,qty};
      });
      const itemsTotal=items.reduce((s,it)=>s+it.price*it.qty,0);
      totalEl.textContent=String(itemsTotal+fee+rush);
      return {items,itemsTotal,fee,rush,total:itemsTotal+fee+rush};
    }
    function openOrder(){ modal.classList.remove('hidden'); modal.classList.add('flex'); computeTotal(); }
    function closeOrder(){ modal.classList.add('hidden'); modal.classList.remove('flex'); }

    openOrderButtons.forEach(id=>{
      const el=document.getElementById(id); if(el) el.addEventListener('click',openOrder);
    });
    if(closeBtn) closeBtn.addEventListener('click',closeOrder);

    if(zoneSelect) zoneSelect.addEventListener('change',computeTotal);
    if(rushToggle) rushToggle.addEventListener('change',computeTotal);
    document.addEventListener('change',e=>{
      if(e.target.classList.contains('itemCheck')||e.target.classList.contains('itemQty')) computeTotal();
    });
    const addCustomBtn=document.getElementById('addCustomItem');
    if(addCustomBtn){addCustomBtn.addEventListener('click',e=>{
      e.preventDefault();const name=prompt('Item name');const price=Number(prompt('Price (R)'))||0;
      if(!name||!price) return; CATALOG.push({name,price}); renderItems(); computeTotal();
    });}
    renderItems();

    const confirmBtn2=document.getElementById('confirmOrderBtn');
    const botModal=document.getElementById('botChat');
    const botClose=document.getElementById('closeBot');
    const botFeed=document.getElementById('botFeed');
    const botNext=document.getElementById('botNext');
    const botSendWA=document.getElementById('botSendWA');
    const botPayChoice=document.getElementById('botPayChoice');
    let _orderDraft=null;

    function openBot(){botModal.classList.remove('hidden');botModal.classList.add('flex');}
    function closeBot(){botModal.classList.add('hidden');botModal.classList.remove('flex');botFeed.innerHTML='';}
    if(botClose) botClose.addEventListener('click',closeBot);

    function pad2(n){return String(n).padStart(2,'0');}
    function nextETA(rush){
      const now=new Date(); const windows=[[8,10],[12,14],[16,18]]; const allowed=new Set([0,3,4,5,6]);
      const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      const fmt=(date,[h1,h2])=>date.toDateString()===new Date().toDateString()
        ? `${pad2(h1)}:00â€“${pad2(h2)}:00 ${rush?'today (rush)':'today'}`
        : `${dayNames[date.getDay()]} ${pad2(h1)}:00â€“${pad2(h2)}:00`;
      if(allowed.has(now.getDay())){for(const w of windows){if(now.getHours()<w[1]) return fmt(now,w);}}
      for(let i=1;i<=7;i++){const d=new Date(now);d.setDate(now.getDate()+i);if(allowed.has(d.getDay())) return fmt(d,windows[0]);}
      return 'TBC';
    }
    function appendBot(msg,who='bot'){
      const wrap=document.createElement('div');
      wrap.className=`flex ${who==='bot'?'justify-start':'justify-end'}`;
      wrap.innerHTML=`<div class="max-w-[80%] rounded-2xl px-3 py-2 text-sm ${who==='bot'?'bg-slate-100':'bg-emerald-600 text-white'}">${msg}</div>`;
      botFeed.appendChild(wrap); botFeed.scrollTop=botFeed.scrollHeight;
    }

    if(confirmBtn2){confirmBtn2.addEventListener('click',()=>{
      const {items,fee,rush,total}=computeTotal(); if(!items.length){alert('Please select at least one item.');return;}
      const zone=zoneSelect.value; const itemsText=items.map(it=>`${it.name} x${it.qty}`).join(', ');
      const pay=document.querySelector('input[name="pay"]:checked').value; const eta=nextETA(Boolean(rush));
      const orderId=`YI-${Date.now().toString().slice(-6)}`;
      _orderDraft={orderId,items,itemsText,fee,rush,total,zone,pay,eta}; closeOrder(); openBot();
      appendBot(`<b>YiThume</b> ðŸ¤–<br/>Thanks for your order!<br/><b>Order ID:</b> ${orderId}<br/><b>Items:</b> ${itemsText}<br/><b>Delivery:</b> Zone ${zone} (R${fee}${rush?` + Rush R${rush}`:''})<br/><b>Total:</b> R${total}<br/><b>Estimated window:</b> ${eta}`);
      appendBot(`Choose your payment method below and press Next.`);
      botPayChoice.value=pay;
    });}
    if(botNext){botNext.addEventListener('click',()=>{
      if(!_orderDraft) return; const pay=botPayChoice.value; _orderDraft.pay=pay;
      if(pay==='eft'){
        appendBot(`<b>Bank (EFT):</b><br/>Account: <code>YiThume Pty Ltd</code><br/>Bank: <code>FNB</code><br/>Acc #: <code>6XX XXX XXXX</code><br/>Branch: <code>250655</code><br/>Ref: <code>${_orderDraft.orderId}</code><br/><i>Reply with POP in WhatsApp after sending.</i>`);
      } else {
        appendBot(`We'll send you a secure <b>card link</b> in WhatsApp. Use reference <code>${_orderDraft.orderId}</code>.`);
      }
      appendBot(`When you're ready, press <b>Send to WhatsApp</b> so we can finalise your order.`);
    });}
    if(botSendWA){botSendWA.addEventListener('click',()=>{
      if(!_orderDraft) return;
      const {orderId,itemsText,fee,rush,total,zone,pay,eta}=_orderDraft;
      const msg=`Yi Thume, my order is:%0A- ${encodeURIComponent(itemsText)}%0ADeliver to: [send pin/address]%0AZone: ${zone} (Delivery R${fee}${rush?` + Rush R${rush}`:''})%0ATotal: R${total}%0AETA: ${eta}%0APayment: ${pay.toUpperCase()}%0APlease confirm and send payment details / link.`;
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`,'_blank'); closeBot();
    });}

    /* ===== HERO MAP (Eastern Cape focus, animated cars/parcels on hidden roads) ===== */
    const heroEl=document.getElementById('heroMap');
    const heroMap=L.map(heroEl,{
      zoomControl:false, dragging:false, scrollWheelZoom:false,
      doubleClickZoom:false, boxZoom:false, touchZoom:false
    }).setView([-33.20, 26.55], 8);

    L.tileLayer(
      'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',
      { attribution:'', opacity:0.96, noWrap:true, detectRetina:true }
    ).addTo(heroMap);

    const southAfricaBounds = L.latLngBounds([[-35.5, 16.0], [-22.0, 33.5]]);
    heroMap.setMaxBounds(southAfricaBounds.pad(0.05));

    const HUBS=[
      {name:'Port Alfred',zone:'A',lat:-33.590,lng:26.890},
      {name:'Bathurst',zone:'B',lat:-33.498,lng:26.833},
      {name:'Kenton-on-Sea',zone:'C',lat:-33.686,lng:26.668},
      {name:'Makhanda/Grahamstown',zone:'D',lat:-33.310,lng:26.520},
      {name:'Alice',zone:'D',lat:-32.787,lng:26.834},
      {name:'Alexandria',zone:'E',lat:-33.653,lng:26.404},
      {name:'Alicedale',zone:'E',lat:-33.321,lng:26.078}
    ];

    const ROADS = [
      [[HUBS[1].lat,HUBS[1].lng],[HUBS[0].lat,HUBS[0].lng]],
      [[HUBS[2].lat,HUBS[2].lng],[HUBS[5].lat,HUBS[5].lng]],
      [[HUBS[6].lat,HUBS[6].lng],[HUBS[3].lat,HUBS[3].lng]],
      [[HUBS[3].lat,HUBS[3].lng],[HUBS[4].lat,HUBS[4].lng]],
      [[HUBS[4].lat,HUBS[4].lng],[HUBS[0].lat,HUBS[0].lng]],
      [[HUBS[3].lat,HUBS[3].lng],[HUBS[2].lat,HUBS[2].lng]],
      [[HUBS[5].lat,HUBS[5].lng],[HUBS[0].lat,HUBS[0].lng]],
      [[HUBS[6].lat,HUBS[6].lng],[HUBS[2].lat,HUBS[2].lng]]
    ];

    function carIcon(zone){
      const cls=`car-dot car-${zone}`;
      const svg=`<svg viewBox='0 0 64 28' aria-hidden='true'>
        <g>
          <rect x='6' y='10' rx='6' ry='6' width='52' height='10' fill='#0f172a' opacity='.85'/>
          <rect x='10' y='5' rx='6' ry='6' width='44' height='14' fill='#ffffff'/>
          <rect x='24' y='6' width='16' height='7' rx='2' fill='#e5e7eb'/>
          <rect x='10' y='9' width='4' height='3' fill='#f59e0b'/>
          <rect x='50' y='9' width='4' height='3' fill='#f59e0b'/>
          <circle cx='18' cy='20' r='3' fill='#0f172a'/>
          <circle cx='46' cy='20' r='3' fill='#0f172a'/>
        </g>
      </svg>`;
      return L.divIcon({className:cls,html:svg,iconSize:[24,12],iconAnchor:[12,6]});
    }
    const pkgSvg=`<svg viewBox='0 0 24 24' aria-hidden='true'><path fill='#059669' d='M3 7l9-4 9 4-9 4-9-4zm0 3l9 4 9-4v7c0 .4-.2.8-.6 1l-7.8 3.5c-.4.2-.8.2-1.2 0L3.6 18c-.4-.2-.6-.6-.6-1V10z'/></svg>`;
    const pkgIcon=L.divIcon({className:'pkg-dot',html:pkgSvg,iconSize:[20,20],iconAnchor:[10,10]});

    function lerp(a,b,t){return a+(b-a)*t;}
    function posOnSeg(seg,t){const [A,B]=seg;return [lerp(A[0],B[0],t), lerp(A[1],B[1],t)];}

    const cars=[], parcels=[];
    function makeCar(zone){
      const seg=ROADS[(Math.random()*ROADS.length)|0];
      const startT=Math.random(), dir=Math.random()<.5?1:-1;
      const speed=0.10+Math.random()*0.06; // fraction of segment per second (smooth)
      const [lat,lng]=posOnSeg(seg,startT);
      const m=L.marker([lat,lng],{icon:carIcon(zone)}).addTo(heroMap);
      cars.push({m,seg,t:startT,dir,speed});
    }
    function makeParcel(){
      const seg=ROADS[(Math.random()*ROADS.length)|0];
      const startT=Math.random(), dir=Math.random()<.5?1:-1;
      const speed=0.12+Math.random()*0.06;
      const [lat,lng]=posOnSeg(seg,startT);
      const m=L.marker([lat,lng],{icon:pkgIcon}).addTo(heroMap);
      parcels.push({m,seg,t:startT,dir,speed});
    }

    for(let i=0;i<10;i++) makeCar(['A','B','C','D','E'][i%5]);
    for(let i=0;i<6;i++)  makeParcel();

    // Smooth animation loop (time-based, no stutter)
    let last=performance.now();
    function animate(now){
      const dt=Math.min((now-last)/1000, 0.05); // clamp to avoid jumps
      last=now;

      for(const c of cars){
        c.t += c.speed * c.dir * dt;
        if(c.t>1){ c.t=1; c.dir=-1; } else if(c.t<0){ c.t=0; c.dir=1; }
        const [lat,lng]=posOnSeg(c.seg,c.t); c.m.setLatLng([lat,lng]);
      }
      for(const p of parcels){
        p.t += p.speed * p.dir * dt;
        if(p.t>1){ p.t=1; p.dir=-1; } else if(p.t<0){ p.t=0; p.dir=1; }
        const [lat,lng]=posOnSeg(p.seg,p.t); p.m.setLatLng([lat,lng]);
      }
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

    setTimeout(()=>heroMap.invalidateSize(),180);
    window.addEventListener('resize',()=>heroMap.invalidateSize());

    const driverModal=document.getElementById('driverModal');
    ['openDriverModal','openDriverModalTop','openDriverModalFooter'].forEach(id=>{
      const el=document.getElementById(id); if(el) el.addEventListener('click',()=>{driverModal.classList.remove('hidden');driverModal.classList.add('flex');});
    });
    const closeDriver=document.getElementById('closeDriverModal');
    if(closeDriver) closeDriver.addEventListener('click',()=>{driverModal.classList.add('hidden');driverModal.classList.remove('flex');});
    const tabSignup=document.getElementById('tabSignup');
    const tabLogin=document.getElementById('tabLogin');
    const formSignup=document.getElementById('driverFormSignup');
    const formLogin=document.getElementById('driverFormLogin');
    if(tabSignup) tabSignup.addEventListener('click',()=>{tabSignup.classList.add('bg-emerald-600','text-white');tabLogin.classList.remove('bg-emerald-600','text-white');formSignup.classList.remove('hidden');formLogin.classList.add('hidden');});
    if(tabLogin) tabLogin.addEventListener('click',()=>{tabLogin.classList.add('bg-emerald-600','text-white');tabSignup.classList.remove('bg-emerald-600','text-white');formLogin.classList.remove('hidden');formSignup.classList.add('hidden');});

    function jitterAround(pt,meters){const d=(meters||800)/111111;const r=Math.random()*d;const a=Math.random()*Math.PI*2;return {lat:pt.lat+r*Math.cos(a),lng:pt.lng+r*Math.sin(a)};}
    if(formSignup){formSignup.addEventListener('submit',e=>{
      e.preventDefault();
      const name=document.getElementById('drvName').value;
      const phone=document.getElementById('drvPhone').value;
      const zone=document.getElementById('drvZone').value;
      const radius=document.getElementById('drvRadius').value;
      const vehicle=document.getElementById('drvVehicle').value;
      const hubs={A:HUBS[0],B:HUBS[1],C:HUBS[2],D:HUBS[3],E:HUBS[5]};
      const hub=hubs[zone]||HUBS[0];
      const start=jitterAround({lat:hub.lat,lng:hub.lng},1500);
      L.marker([start.lat,start.lng],{icon:carIcon(zone)}).addTo(heroMap);
      const text=encodeURIComponent(`New driver sign-up
Name: ${name}
Phone: ${phone}
Zone: ${zone}
Radius: ${radius}km
Vehicle: ${vehicle}`);
      window.open(`https://wa.me/${ADMIN_WHATSAPP}?text=${text}`,'_blank');
      driverModal.classList.add('hidden');driverModal.classList.remove('flex');
    });}

    if(formLogin){formLogin.addEventListener('submit',e=>{
      e.preventDefault(); alert('Logged in (demo). Driver tasks coming next).');
      driverModal.classList.add('hidden');driverModal.classList.remove('flex');
    });}
  });
  </script>
</body>
</html>
